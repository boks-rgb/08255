<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ë³µì“°ìŒ¤ì˜ ë³´ì„ëŒ€í™”</title>
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React 18 UMD -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel: ë¸Œë¼ìš°ì €ì—ì„œ JSX ë³€í™˜ -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <meta name="color-scheme" content="light only" />
  </head>
  <body class="bg-gradient-to-b from-pink-100 via-white to-indigo-100 min-h-screen">
    <div id="root"></div>

    <!-- ì•± ì½”ë“œ (JSX): ë°˜ë“œì‹œ type="text/babel" -->
    <script type="text/babel">
      const { useEffect, useMemo, useState } = React;

      /* ========== ìœ í‹¸ ========== */
      const PALETTE = [
        "bg-rose-100 text-rose-600","bg-amber-100 text-amber-700",
        "bg-emerald-100 text-emerald-700","bg-sky-100 text-sky-700",
        "bg-violet-100 text-violet-700","bg-fuchsia-100 text-fuchsia-700",
        "bg-teal-100 text-teal-700","bg-orange-100 text-orange-700",
      ];
      const colorFor = (i) => PALETTE[i % PALETTE.length];
      const formatDate = (d) => `${d.getFullYear()}ë…„ ${d.getMonth() + 1}ì›” ${d.getDate()}ì¼`;

      /* ========== 52ê°œ ë¯¸ë• + ì´ëª¨ì§€ ========== */
      const VIRTUES = [
        // 1ì—´
        { key: "ê°ì‚¬", name: "ê°ì‚¬", easy: "ë°›ì€ ë„ì›€ì— ê³ ë§ˆì›€ì„ í‘œí˜„í•´ìš”", emoji: "ğŸ™" },
        { key: "ê²°ì˜", name: "ê²°ì˜", easy: "ë§ˆìŒë¨¹ì€ ì¼ì„ ëê¹Œì§€ í•˜ë ¤ëŠ” ë‹¤ì§ì´ì—ìš”", emoji: "ğŸ§—" },
        { key: "ê²¸ì†", name: "ê²¸ì†", easy: "ì˜í•´ë„ ìë‘í•˜ì§€ ì•Šê³  ë°°ì›Œìš”", emoji: "ğŸ™‡" },
        { key: "ê´€ìš©", name: "ê´€ìš©", easy: "ë‹¤ë¥¸ ì‚¬ëŒì˜ ì‹¤ìˆ˜ë¥¼ ì´í•´í•˜ê³  ìš©ì„œí•´ìš”", emoji: "ğŸ¤" },
        { key: "ê·¼ë©´", name: "ê·¼ë©´", easy: "ë¶€ì§€ëŸ°íˆ í•  ì¼ì„ í•´ìš”", emoji: "ğŸ› ï¸" },
        { key: "ê¸°ë°±í•¨", name: "ê¸°ë°±í•¨", easy: "ì”©ì”©í•˜ê³  ë‹¹ë‹¹í•œ íƒœë„ì˜ˆìš”", emoji: "ğŸ¦" },
        { key: "ê¸°ì§€", name: "ê¸°ì§€", easy: "ì¬ì¹˜ ìˆê²Œ í•´ê²°ì±…ì„ ì°¾ì•„ìš”", emoji: "ğŸ§ " },
        { key: "ëˆê¸°", name: "ëˆê¸°", easy: "ì–´ë ¤ì›Œë„ í¬ê¸°í•˜ì§€ ì•Šì•„ìš”", emoji: "ğŸ¢" },
        { key: "ë„ˆê·¸ëŸ¬ì›€", name: "ë„ˆê·¸ëŸ¬ì›€", easy: "ë§ˆìŒì´ ë„“ê³  ë”°ëœ»í•´ìš”", emoji: "ğŸ¤—" },
        { key: "ë„ì›€", name: "ë„ì›€", easy: "ë¨¼ì € ë‚˜ì„œì„œ ë„ì™€ìš”", emoji: "ğŸ«±â€ğŸ«²" },
        { key: "ëª…ì˜ˆ", name: "ëª…ì˜ˆ", easy: "ë¶€ë„ëŸ½ì§€ ì•Šê²Œ í–‰ë™í•´ìš”", emoji: "ğŸ…" },
        { key: "ëª©ì ì˜ì‹", name: "ëª©ì ì˜ì‹", easy: "ì™œ í•˜ëŠ”ì§€ ì•Œê³  ì§‘ì¤‘í•´ìš”", emoji: "ğŸ¯" },
        { key: "ë¯¿ìŒì§í•¨", name: "ë¯¿ìŒì§í•¨", easy: "ì•½ì†ì„ ì§€ì¼œ ë¯¿ì„ ìˆ˜ ìˆì–´ìš”", emoji: "ğŸ›¡ï¸" },
        // 2ì—´
        { key: "ë°°ë ¤", name: "ë°°ë ¤", easy: "ë‹¤ë¥¸ ì‚¬ëŒ ë§ˆìŒì„ ë¨¼ì € ìƒê°í•´ìš”", emoji: "ğŸ’" },
        { key: "ë´‰ì‚¬", name: "ë´‰ì‚¬", easy: "ê¸°êº¼ì´ ë•ê³  ë‚˜ëˆ ìš”", emoji: "ğŸ‘" },
        { key: "ì‚¬ë‘", name: "ì‚¬ë‘", easy: "ì†Œì¤‘í•œ ì‚¬ëŒì„ ì•„ë¼ê³  í‘œí˜„í•´ìš”", emoji: "â¤ï¸" },
        { key: "ì‚¬ë ¤", name: "ì‚¬ë ¤", easy: "ì˜ ìƒê°í•´ì„œ í–‰ë™í•´ìš”", emoji: "ğŸ¤”" },
        { key: "ìƒëƒ¥í•¨", name: "ìƒëƒ¥í•¨", easy: "ë¶€ë“œëŸ½ê³  ì¹œì ˆí•˜ê²Œ ë§í•´ìš”", emoji: "ğŸ˜Š" },
        { key: "ì†Œì‹ ", name: "ì†Œì‹ ", easy: "ì˜³ë‹¤ê³  ë¯¿ëŠ” ê²ƒì„ ë‹¹ë‹¹íˆ ë§í•´ìš”", emoji: "ğŸ“£" },
        { key: "ì‹ ë¢°", name: "ì‹ ë¢°", easy: "ì„œë¡œ ë¯¿ê³  ì˜ì§€í•´ìš”", emoji: "ğŸ¤" },
        { key: "ì‹ ìš©", name: "ì‹ ìš©", easy: "ë¹Œë¦° ê²ƒì€ ê¼­ ê°šì•„ìš”", emoji: "ğŸ“œ" },
        { key: "ì—´ì •", name: "ì—´ì •", easy: "ë§ˆìŒ ë‹¤í•´ ì—´ì‹¬íˆ í•´ìš”", emoji: "ğŸ”¥" },
        { key: "ì˜ˆì˜", name: "ì˜ˆì˜", easy: "ì˜ˆì˜ë¥¼ ì§€ì¼œ ì¡´ì¤‘í•´ìš”", emoji: "ğŸ™‡â€â™‚ï¸" },
        { key: "ìš©ê¸°", name: "ìš©ê¸°", easy: "ë‘ë ¤ì›Œë„ ë°”ë¥´ê²Œ í–‰ë™í•´ìš”", emoji: "ğŸ¦Š" },
        { key: "ìš©ì„œ", name: "ìš©ì„œ", easy: "ë¯¸ì›€ì„ í’€ê³  ë‹¤ì‹œ ì¹œí•´ì ¸ìš”", emoji: "ğŸ•Šï¸" },
        { key: "ìš°ì˜", name: "ìš°ì˜", easy: "ì¹œêµ¬ ì‚¬ì´ì˜ ê¹Šì€ ì •ì´ì—ìš”", emoji: "ğŸ«¶" },
        // 3ì—´
        { key: "ìœ ì—°ì„±", name: "ìœ ì—°ì„±", easy: "ìƒí™©ì— ë§ê²Œ ìƒê°ì„ ë°”ê¿€ ì¤„ ì•Œì•„ìš”", emoji: "ğŸ§˜" },
        { key: "ì´ìƒì¶”êµ¬", name: "ì´ìƒì¶”êµ¬", easy: "ë” ë‚˜ì€ ë‚˜ë¥¼ ê¿ˆê¾¸ê³  ë…¸ë ¥í•´ìš”", emoji: "ğŸš€" },
        { key: "ì´í•´", name: "ì´í•´", easy: "ê·¸ëŸ´ ìˆ˜ë„ ìˆê² ë‹¤ í•˜ê³  ì•Œì•„ì¤˜ìš”", emoji: "ğŸ§©" },
        { key: "ì¸ë‚´", name: "ì¸ë‚´", easy: "ê¸°ë‹¤ë¦´ ì¤„ ì•Œì•„ìš”", emoji: "ğŸ§˜â€â™‚ï¸" },
        { key: "ì¸ë‚´ì‹¬", name: "ì¸ë‚´ì‹¬", easy: "ì¡°ê¸ˆì”© ê¾¸ì¤€íˆ ë²„í‹°ëŠ” í˜ì´ì—ìš”", emoji: "â³" },
        { key: "ììœ¨", name: "ììœ¨", easy: "ìŠ¤ìŠ¤ë¡œ ê³„íší•˜ê³  ì‹¤ì²œí•´ìš”", emoji: "ğŸ§­" },
        { key: "ì ˆë„", name: "ì ˆë„", easy: "ë§ê³¼ í–‰ë™ì— ë‹¨ì •í•¨ì´ ìˆì–´ìš”", emoji: "ğŸ©" },
        { key: "ì •ëˆ", name: "ì •ëˆ", easy: "í©ì–´ì§„ ê²ƒì„ ê°€ì§€ëŸ°íˆ í•´ìš”", emoji: "ğŸ§º" },
        { key: "ì •ì˜ë¡œì›€", name: "ì •ì˜ë¡œì›€", easy: "ì˜³ê³  ê·¸ë¦„ì„ ë¶„ëª…íˆ í•´ìš”", emoji: "ğŸ›ï¸" },
        { key: "ì •ì§", name: "ì •ì§", easy: "ê±°ì§“ë§í•˜ì§€ ì•Šê³  ì†”ì§í•´ìš”", emoji: "ğŸª" },
        { key: "ì¡´ì¤‘", name: "ì¡´ì¤‘", easy: "ë‹¤ë¥¸ ì‚¬ëŒì„ ì†Œì¤‘íˆ ëŒ€í•´ìš”", emoji: "ğŸ™" },
        { key: "ì¤‘ìš©", name: "ì¤‘ìš©", easy: "ì¹˜ìš°ì¹˜ì§€ ì•Šê³  ê³ ë¥´ê²Œ í•´ìš”", emoji: "âš–ï¸" },
        { key: "ì§„ì‹¤í•¨", name: "ì§„ì‹¤í•¨", easy: "ë§ˆìŒê³¼ ë§ì´ ê±°ì§“ì´ ì—†ì–´ìš”", emoji: "ğŸ’" },
        // 4ì—´
        { key: "ì°½ì˜ì„±", name: "ì°½ì˜ì„±", easy: "ìƒˆë¡œìš´ ë°©ë²•ì„ ë– ì˜¬ë ¤ìš”", emoji: "ğŸ’¡" },
        { key: "ì±…ì„ê°", name: "ì±…ì„ê°", easy: "ë§¡ì€ ì¼ì„ ëê¹Œì§€ í•´ìš”", emoji: "ğŸ§°" },
        { key: "ì²­ê²°", name: "ì²­ê²°", easy: "ì£¼ë³€ì„ ê¹¨ë—ì´ í•´ìš”", emoji: "ğŸ§¼" },
        { key: "ì´ˆì—°", name: "ì´ˆì—°", easy: "ë§ˆìŒì„ í”ë“¤ì§€ ì•Šê³  í¸ì•ˆíˆ í•´ìš”", emoji: "ğŸ•¯ï¸" },
        { key: "ì¶©ì§", name: "ì¶©ì§", easy: "ì„±ì‹¤í•˜ê³  ë¯¿ìŒì„ ì €ë²„ë¦¬ì§€ ì•Šì•„ìš”", emoji: "ğŸ¶" },
        { key: "ì¹œì ˆ", name: "ì¹œì ˆ", easy: "ë”°ëœ»í•œ ë§ê³¼ í–‰ë™ì„ í•´ìš”", emoji: "ğŸŒ·" },
        { key: "íƒì›”í•¨", name: "íƒì›”í•¨", easy: "ë” ë‚˜ì€ ê²°ê³¼ë¥¼ ìœ„í•´ í•œ ë²ˆ ë” ì‚´í´ìš”", emoji: "ğŸ¥‡" },
        { key: "í‰ì˜¨í•¨", name: "í‰ì˜¨í•¨", easy: "ë§ˆìŒì´ ì°¨ë¶„í•˜ê³  ì•ˆì •ë¼ìš”", emoji: "ğŸ•Šï¸" },
        { key: "í•œê²°ê°™ìŒ", name: "í•œê²°ê°™ìŒ", easy: "ì²˜ìŒê³¼ ëì´ ë³€í•¨ì´ ì—†ì–´ìš”", emoji: "ğŸŒ¿" },
        { key: "í—Œì‹ ", name: "í—Œì‹ ", easy: "ê¸°êº¼ì´ í˜ê³¼ ì‹œê°„ì„ ë‚´ì–´ ë„ì™€ìš”", emoji: "ğŸ—ï¸" },
        { key: "í˜‘ë™", name: "í˜‘ë™", easy: "í˜ì„ í•©ì³ í•¨ê»˜í•´ìš”", emoji: "ğŸ§©" },
        { key: "í™”í•©", name: "í™”í•©", easy: "ì‚¬ì´ì¢‹ê²Œ ì–´ìš¸ë ¤ ì§€ë‚´ìš”", emoji: "ğŸ¶" },
        { key: "í™•ì‹ ", name: "í™•ì‹ ", easy: "ìì‹ ì˜ ì„ íƒì„ ë¯¿ê³  ë‚˜ì•„ê°€ìš”", emoji: "âœ…" },
      ];

      /* ========== AES-GCM ì €ì¥ (HTTPS/localhost í•„ìš”) ========== */
      const storageKey = "gemcards.v1";
      const SECURE = window.isSecureContext;

      async function getOrCreateCryptoKey() {
        const existing = localStorage.getItem("gemcards.aesKeyBase64");
        if (existing) {
          const raw = Uint8Array.from(atob(existing), c => c.charCodeAt(0));
          return crypto.subtle.importKey("raw", raw, { name: "AES-GCM" }, false, ["encrypt","decrypt"]);
        }
        const rawKey = crypto.getRandomValues(new Uint8Array(32));
        localStorage.setItem("gemcards.aesKeyBase64", btoa(String.fromCharCode(...rawKey)));
        return crypto.subtle.importKey("raw", rawKey, { name: "AES-GCM" }, false, ["encrypt","decrypt"]);
      }
      async function encryptText(plain) {
        const key = await getOrCreateCryptoKey();
        const iv = crypto.getRandomValues(new Uint8Array(12));
        const enc = new TextEncoder().encode(plain);
        const cipher = await crypto.subtle.encrypt({ name: "AES-GCM", iv }, key, enc);
        return `${btoa(String.fromCharCode(...iv))}:${btoa(String.fromCharCode(...new Uint8Array(cipher)))}`;
      }
      async function decryptText(payload) {
        const [ivB64, ctB64] = payload.split(":");
        const key = await getOrCreateCryptoKey();
        const iv = Uint8Array.from(atob(ivB64), c => c.charCodeAt(0));
        const ct = Uint8Array.from(atob(ctB64), c => c.charCodeAt(0));
        const buf = await crypto.subtle.decrypt({ name: "AES-GCM", iv }, key, ct);
        return new TextDecoder().decode(buf);
      }
      const Storage = {
        async add(card) {
          if (!SECURE) { alert("ë³´ì•ˆ ì—°ê²°(HTTPS/localhost)ì—ì„œë§Œ â€˜ë³´ì„ìœ¼ë¡œ ì €ì¥â€™ ê°€ëŠ¥í•´ìš” (GitHub Pages ê¶Œì¥)"); return; }
          const list = JSON.parse(localStorage.getItem(storageKey) || "[]");
          const cipher = await encryptText(JSON.stringify(card));
          list.push({ id: crypto.randomUUID(), cipher, tags: card.tags, createdAt: Date.now() });
          localStorage.setItem(storageKey, JSON.stringify(list));
        },
        async list() {
          const list = JSON.parse(localStorage.getItem(storageKey) || "[]");
          const out = [];
          for (const row of list) {
            try {
              const plain = await decryptText(row.cipher);
              out.push({ ...row, card: JSON.parse(plain) });
            } catch {
              out.push({ ...row, error: true });
            }
          }
          return out;
        },
      };

      /* ========== ë”°ëœ»í•œ ë¬¸ì¥ 3ê°€ì§€ ========== */
      function warm(virtueName, name) {
        const who = name ? `${name}ë‹˜` : "ë„ˆ";
        return [
          `${who}, ${virtueName}ì„(ë¥¼) ì„ íƒí•œ ë§ˆìŒì´ ì°¸ ê³ ì™€ìš”.`,
          `ì‘ì€ ì‹¤ì²œì´ í° ë³€í™”ë¥¼ ë§Œë“¤ì–´ìš”. ì˜¤ëŠ˜ì˜ ${virtueName}ì´ ë°˜ì§ì—¬ìš”.`,
          `ê´œì°®ì•„ìš”, ì²œì²œíˆ í•´ë„ ì¢‹ì•„ìš”. ë‹¤ì‹œ í•´ë³´ëŠ” ë§ˆìŒì´ ë°”ë¡œ ${virtueName}ì´ì—ìš”.`,
        ];
      }

      /* ========== UI ì¡°ê° ========== */
      function VirtueCard({ virtue, onSelect, index }) {
        const badge = colorFor(index);
        return (
          <button
            onClick={onSelect}
            className="flex items-center gap-3 p-4 rounded-2xl border shadow-sm hover:shadow-lg transition text-left bg-gradient-to-r from-white via-pink-50 to-indigo-50 bg-[radial-gradient(circle_at_top_left,rgba(255,255,255,0.8),transparent_70%)]"
          >
            <div className={`w-12 h-12 flex items-center justify-center rounded-full text-xl ${badge}`}>
              <span aria-hidden>{virtue.emoji}</span>
            </div>
            <div>
              <div className="font-semibold text-lg">{virtue.name}</div>
              <div className="text-sm text-gray-600">{virtue.easy}</div>
            </div>
          </button>
        );
      }

      function CardPreview({ dateStr, name, message, virtue }) {
        return (
          <div className="max-w-xl w-full mx-auto">
            <div className="rounded-2xl shadow-lg p-6 bg-gradient-to-br from-white via-indigo-50 to-pink-50 border bg-[radial-gradient(circle_at_top_right,rgba(173,216,230,0.25),transparent_70%)]">
              <div className="text-sm text-gray-500 mb-2">{dateStr}, {name || "ì´ë¦„ ì—†ìŒ"}ì—ê²Œ</div>
              <div className="text-lg leading-relaxed whitespace-pre-wrap">{message}</div>
              <div className="mt-4 text-right text-sm text-gray-600">(ì˜¤ëŠ˜ì˜ ë¯¸ë•: {virtue})</div>
            </div>
          </div>
        );
      }

      /* ========== ì•± ========== */
      function App() {
        const [step, setStep] = useState("start");            // start -> pick -> detail -> card
        const [today] = useState(new Date());
        const dateStr = useMemo(() => formatDate(today), [today]);
        const [name, setName] = useState("");
        const [virtue, setVirtue] = useState(null);
        const [message, setMessage] = useState("");
        const [saving, setSaving] = useState(false);
        const [savedToast, setSavedToast] = useState(null);
        const [savedList, setSavedList] = useState([]);

        // ì´ë¦„ ì €ì¥/ë³µì›
        useEffect(() => { const saved = localStorage.getItem("gemcards.name"); if (saved) setName(saved); }, []);
        useEffect(() => { if (name) localStorage.setItem("gemcards.name", name); }, [name]);

        // ì €ì¥ ëª©ë¡(ë¯¸ë¦¬ë³´ê¸°)
        useEffect(() => { (async () => setSavedList(await Storage.list()))(); }, [savedToast]);

        const startNew = () => { setVirtue(null); setMessage(""); setStep("start"); };

        return (
          <div className="min-h-screen pb-20 bg-[radial-gradient(circle_at_bottom_right,rgba(255,182,193,0.3),transparent_70%)]">
            <header className="sticky top-0 z-10 backdrop-blur bg-white/70 border-b">
              <div className="max-w-3xl mx-auto px-4 py-3 flex items-center justify-between">
                <div className="font-semibold">ë³µì“°ìŒ¤ì˜ ë³´ì„ëŒ€í™”</div>
                <div className="flex items-center gap-3 text-sm">
                  <span className="text-gray-500">{dateStr}</span>
                  <button onClick={startNew} className="px-3 py-1 rounded-full bg-indigo-600 text-white hover:bg-indigo-700 transition">ì˜¤ëŠ˜ì˜ ë³´ì„ ì‹œì‘</button>
                </div>
              </div>
            </header>

            <main className="max-w-3xl mx-auto px-4 pt-6">
              {!SECURE && (
                <div className="mb-3 text-xs text-rose-700 bg-rose-50 border border-rose-200 rounded-lg p-3">
                  âš ï¸ í˜„ì¬ ë³´ì•ˆ ì—°ê²°ì´ ì•„ë‹™ë‹ˆë‹¤. <b>GitHub Pages</b> ë˜ëŠ” <b>localhost</b>ì—ì„œ ì—´ì–´ì•¼
                  â€˜ë³´ì„ìœ¼ë¡œ ì €ì¥(ì•”í˜¸í™”)â€™ì´ ì •ìƒ ì‘ë™í•´ìš”.
                </div>
              )}
              <p className="mb-4 text-xs text-gray-500">
                ì´ ì•±ì€ ì…ë ¥ ë‚´ìš©ì„ ë¸Œë¼ìš°ì € ì•ˆì—ë§Œ ì €ì¥í•˜ë©°, ì„œë²„ë¡œ ì „ì†¡Â·ê²€ìƒ‰Â·ê³µìœ í•˜ì§€ ì•Šì•„ìš”.
              </p>

              {step === "start" && (
                <section className="space-y-6">
                  <div className="relative overflow-hidden rounded-3xl p-6 bg-gradient-to-br from-rose-50 via-white to-indigo-50 border bg-[radial-gradient(circle_at_20%_0%,rgba(255,182,193,0.35),transparent_60%)]">
                    <div className="absolute -top-6 -right-6 w-24 h-24 rounded-full bg-pink-200/40"></div>
                    <div className="absolute -bottom-8 -left-8 w-28 h-28 rounded-full bg-indigo-200/30"></div>
                    <div className="relative">
                      <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs bg-white/80 border">
                        <span aria-hidden>ğŸ’</span> ì˜¤ëŠ˜ì˜ ë³´ì„ ì¤€ë¹„í•˜ê¸°
                      </div>
                      <h1 className="mt-3 text-3xl font-extrabold tracking-tight">ë³µì“°ìŒ¤ì˜ ë³´ì„ëŒ€í™”</h1>
                      <p className="mt-1 text-sm text-gray-600">ë”°ëœ»í•œ í•œë§ˆë””ë¡œ ì˜¤ëŠ˜ì„ ë°˜ì§ì´ê²Œ í•´ë´ìš” âœ¨</p>
                      <div className="mt-4 text-sm text-gray-600">
                        ì˜¤ëŠ˜ ë‚ ì§œ: <strong>{dateStr}</strong>
                      </div>

                      <div className="mt-5 rounded-2xl border bg-white/80 backdrop-blur p-4">
                        <label className="block">
                          <span className="text-sm">ë‚´ ì´ë¦„</span>
                          <input
                            className="mt-1 w-full rounded-xl border p-3 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                            placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”"
                            value={name}
                            onChange={(e) => setName(e.target.value)}
                          />
                        </label>
                        <div className="mt-3 flex items-center justify-between">
                          <p className="text-xs text-gray-500">ë¸Œë¼ìš°ì € ì•ˆì—ë§Œ ì €ì¥ë¼ìš”. ì™¸ë¶€ ì „ì†¡Â·ê²€ìƒ‰Â·ê³µìœ  ì—†ìŒ.</p>
                          <button
                            onClick={() => setStep("pick")}
                            className="px-5 py-3 rounded-2xl bg-indigo-600 text-white font-medium hover:bg-indigo-700 transition disabled:opacity-50"
                            disabled={!name}
                            title={!name ? "ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" : "ë‹¤ìŒ"}
                          >
                            ë‹¤ìŒ â†’
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>

                  {savedList?.length > 0 && (
                    <div className="mt-6">
                      <h2 className="font-semibold mb-2">ìµœê·¼ ë³´ì„ (ë¡œì»¬)</h2>
                      <ul className="grid md:grid-cols-2 gap-3">
                        {savedList.slice(-6).reverse().map((row) => (
                          <li key={row.id} className="rounded-xl border p-3 bg-white">
                            <div className="text-xs text-gray-500 mb-1">{formatDate(new Date(row.createdAt))}</div>
                            {row.card ? (
                              <div className="text-sm">
                                {row.card.message.substring(0, 60)}â€¦ <span className="text-gray-500">({row.card.virtueName})</span>
                              </div>
                            ) : (
                              <div className="text-xs text-red-500">ë³µí˜¸í™” ì‹¤íŒ¨</div>
                            )}
                          </li>
                        ))}
                      </ul>
                    </div>
                  )}
                </section>
              )}

              {step === "pick" && (
                <section>
                  <h1 className="text-2xl font-bold mb-4">ë¯¸ë• ì„ íƒ</h1>
                  <div className="grid md:grid-cols-2 gap-3">
                    {VIRTUES.map((v, i) => (
                      <VirtueCard
                        key={v.key}
                        virtue={v}
                        index={i}
                        onSelect={() => { setVirtue(v); setStep("detail"); }}
                      />
                    ))}
                  </div>
                </section>
              )}

              {step === "detail" && virtue && (
                <section className="space-y-6">
                  <h1 className="text-2xl font-bold">{virtue.name}</h1>
                  <p className="text-gray-700">{virtue.easy}</p>
                  <div>
                    <h2 className="font-semibold mb-2">ë”°ëœ»í•œ ë¬¸ì¥ 3ê°€ì§€ ì¤‘ ì„ íƒ</h2>
                    <div className="grid gap-3">
                      {warm(virtue.name, name).map((m, idx) => (
                        <button
                          key={idx}
                          onClick={() => { setMessage(m); setStep("card"); }}
                          className="text-left rounded-2xl border p-4 bg-white hover:shadow transition"
                        >
                          {m}
                        </button>
                      ))}
                    </div>
                  </div>
                </section>
              )}

              {step === "card" && virtue && (
                <section className="space-y-6">
                  <h1 className="text-2xl font-bold">ë³´ì„ì¹´ë“œ</h1>
                  <CardPreview dateStr={dateStr} name={name} message={message} virtue={virtue.name} />
                  <div className="flex gap-3">
                    <button
                      onClick={async () => {
                        try {
                          setSaving(true);
                          const record = { dateStr, name, virtueKey: virtue.key, virtueName: virtue.name, message, tags: [virtue.key, virtue.name] };
                          await Storage.add(record);
                          alert(SECURE ? "ë³´ì„ìœ¼ë¡œ ì €ì¥í–ˆì–´ìš” âœ¨" : "HTTPS/localhostì—ì„œë§Œ ì €ì¥ì´ ê°€ëŠ¥í•´ìš”.");
                        } finally {
                          setSaving(false);
                        }
                      }}
                      className="px-5 py-3 rounded-2xl bg-emerald-600 text-white font-medium hover:bg-emerald-700 transition disabled:opacity-50"
                      disabled={saving}
                    >
                      {saving ? "ì €ì¥ ì¤‘â€¦" : "ë³´ì„ìœ¼ë¡œ ì €ì¥"}
                    </button>
                    <button onClick={() => { setVirtue(null); setMessage(""); setStep("start"); }} className="px-5 py-3 rounded-2xl border font-medium hover:bg-gray-50">
                      ì˜¤ëŠ˜ì˜ ë³´ì„ ì‹œì‘
                    </button>
                  </div>
                </section>
              )}
            </main>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
